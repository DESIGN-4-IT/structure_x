class MUDeadendForm5(forms.ModelForm):   # *************
    class Meta:
        model = mUploadedFile5               # *************
        fields = ('structure', 'file')

    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        # Remove the filtering if we're hardcoding the structure in the view
        used_structures = mUploadedFile5.objects.values_list('structure_id', flat=True)   # *************
        self.fields['structure'].queryset = ListOfStructure.objects.exclude(id__in=used_structures)
        self.fields['structure'].empty_label = "Select Structure"
        # Make the field not required since we're setting it in the view
        self.fields['structure'].required = False

    def clean_file(self):
        uploaded_file = self.cleaned_data.get('file')
        ext = os.path.splitext(uploaded_file.name)[1].lower()
        if ext not in ['.xls', '.xlsx']:
            raise ValidationError("Only Excel files (.xls or .xlsx) are allowed.")
        return uploaded_file


class UploadedFileForm(forms.ModelForm):   # *************
    class Meta:
        model = UploadedFile1               # *************
        fields = ('structure', 'file')

    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        # Remove the filtering if we're hardcoding the structure in the view
        used_structures = UploadedFile1.objects.values_list('structure_id', flat=True)   # *************
        self.fields['structure'].queryset = ListOfStructure.objects.exclude(id__in=used_structures)
        self.fields['structure'].empty_label = "Select Structure"
        # Make the field not required since we're setting it in the view
        self.fields['structure'].required = False

    def clean_file(self):
        uploaded_file = self.cleaned_data.get('file')
        ext = os.path.splitext(uploaded_file.name)[1].lower()
        if ext not in ['.xls', '.xlsx']:
            raise ValidationError("Only Excel files (.xls or .xlsx) are allowed.")
        return uploaded_file
    