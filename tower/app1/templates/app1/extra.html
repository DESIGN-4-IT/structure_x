First, carefully review the existing hdata1 page canvas implementation and act as an experienced 3D developer.

Please refer to both images.

On the hdata1 page, the 3D model is displayed inside a canvas container with grid guides.

In the first image, the 3D model is surrounded by complete and properly aligned grid planes, covering the entire model uniformly.

In the second image, for some tower models, the grid guides appear incomplete or inconsistent, and the model looks placed inside the grids instead of being fully covered by them.

I want the same grid structure shown in the first image to be applied consistently to all 3D models, regardless of the tower type.

The grid planes should:

Fully cover the entire 3D model

Be evenly spaced and properly aligned on all axes (X, Y, Z)

Automatically adjust based on the model‚Äôs size and position

Remain consistent for every structure (Tower, H-Frame, Monopole)

The goal is to ensure that every 3D model displayed on the hdata1 page uses the same complete grid layout as shown in the first image.

this is hdata1.html 

" <div class="container">
        <h3>OVERHEAD LOAD DESIGN CRITERIA</h3>
        
        <div class="row">
            <!-- Left side - Selection Options (reduced width) -->
            <div class="col-md-4">
                {% if button_type == 'joint_labels' %}
                <!-- Show only joint labels section when joint labels button was clicked -->
                <div class="form-group">
                    <label for="joint-labels">Attachment Joint Labels:</label>
                    <div class="checkbox-list" id="joint-labels">
                        {% for label in joint_labels %}
                            <label draggable="true" class="drag-item" data-type="joint" data-value="{{ label }}">
                                <input type="checkbox" name="joint-labels" value="{{ label }}"> {{ label }}
                            </label>
                        {% endfor %}
                    </div>
                </div>
                {% elif button_type == 'set_phase' %}
                <!-- Show only set/phase sections when set/phase button was clicked -->
                <div class="form-group">
                    <label for="set-select">Set No.:</label>
                    <select id="set-select" class="form-control" multiple size="4">
                        {% for num in set_numbers %}
                            <option value="{{ num|floatformat:0 }}">{{ num|floatformat:0 }}</option>
                        {% endfor %}
                    </select>
                    <small class="form-text text-muted">Hold Ctrl/Cmd to select multiple sets</small>
                </div>

                <div class="form-group">
                    <label for="phase-select">Phase No.:</label>
                    <select id="phase-select" class="form-control" multiple size="4">
                        {% for num in phase_numbers %}
                            <option value="{{ num|floatformat:0 }}">{{ num|floatformat:0 }}</option>
                        {% endfor %}
                    </select>
                    <small class="form-text text-muted">Hold Ctrl/Cmd to select multiple phases</small>
                </div>
                <!-- Combination Builder Section -->
                <div class="form-group">
                    <label>Create Set-Phase Combinations:</label>
                    <div class="combination-builder">
                        <div class="selected-items mb-2">
                            <strong>Selected Sets:</strong> 
                            <span id="selected-sets-display">None</span>
                        </div>
                        <div class="selected-items mb-2">
                            <strong>Selected Phases:</strong> 
                            <span id="selected-phases-display">None</span>
                        </div>
                        <button id="create-all-combinations" class="btn btn-primary btn-sm">
                            Create All Combinations
                        </button>
                        <button id="create-single-combination" class="btn btn-success btn-sm">
                            Create Single Combination
                        </button>
                        <button id="clear-combinations" class="btn btn-secondary btn-sm">
                            Clear All
                        </button>
                    </div>
                </div>

                <!-- Active Combinations Display -->
                <div class="form-group">
                    <label>Active Combinations:</label>
                    <div id="active-combinations" class="active-combinations-list">
                        <!-- Combinations will be displayed here -->
                    </div>
                </div>
                {% endif %}
            </div>
            
            <!-- Right side - 3D Model Viewer (increased width) -->
            <div class="col-md-8">
                <div class="model-viewer-container">
                    <div style="position: absolute; top: 10px; right: 10px; z-index: 100;">
                        <button id="grid-toggle-btn" class="btn btn-warning btn-sm">
                            Hide Grid
                        </button>
                        <!-- Enhanced Control Panel -->
                        <div class="movement-controls-panel">
                        <h6 style="margin: 0 0 10px 0; color: #333;">Movement Controls</h6>

                        {% comment %} <!-- Drop Mode Selection -->
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; font-size: 12px; margin-bottom: 5px; font-weight: bold;">Drop Mode:</label>
                                <select id="drop-mode" style="width: 100%; padding: 5px; font-size: 12px;">
                                    <option value="precise">Precise Placement</option>
                                    <option value="free">Free Placement</option>
                                </select>
                            </div>

                            <!-- Grid Snapping -->
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; font-size: 12px; margin-bottom: 5px; font-weight: bold;">Grid Snapping:</label>
                                <select id="grid-snap" style="width: 100%; padding: 5px; font-size: 12px;">
                                    <option value="0.1">Fine (0.1)</option>
                                    <option value="0.25" selected>Medium (0.25)</option>
                                    <option value="0.5">Coarse (0.5)</option>
                                    <option value="0">Off</option>
                                </select>
                            </div> {% endcomment %}
                        
                        <!-- Movement Controls -->
                        <div style="margin-bottom: 10px;">
                            <label style="display: block; font-size: 12px; margin-bottom: 8px; font-weight: bold;">Arrow Movement:</label>
                            
                            <!-- Up/Down Controls -->
                            <div style="display: flex; justify-content: center; margin-bottom: 5px;">
                                <button class="movement-btn" data-axis="y" data-direction="1" style="margin: 0 5px;">‚Üë</button>
                            </div>
                            
                            <!-- Left/Right/Front/Back Controls -->
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <button class="movement-btn" data-axis="x" data-direction="-1" style="margin: 0 2px;">‚Üê</button>
                                
                                <div style="display: flex; flex-direction: column; align-items: center;">
                                    <button class="movement-btn" data-axis="z" data-direction="-1" style="margin: 2px 0; font-size: 10px;">Front</button>
                                    <button class="movement-btn" data-axis="z" data-direction="1" style="margin: 2px 0; font-size: 10px;">Back</button>
                                </div>
                                
                                <button class="movement-btn" data-axis="x" data-direction="1" style="margin: 0 2px;">‚Üí</button>
                            </div>
                            
                            <!-- Down Control -->
                            <div style="display: flex; justify-content: center; margin-top: 5px;">
                                <button class="movement-btn" data-axis="y" data-direction="-1" style="margin: 0 5px;">‚Üì</button>
                            </div>
                        </div>

                        <!-- Step Size -->
                        <div style="margin-bottom: 10px;">
                            <label style="display: block; font-size: 12px; margin-bottom: 5px; font-weight: bold;">Step Size:</label>
                            <input type="range" id="step-size" min="0.05" max="1" step="0.05" value="0.25" style="width: 100%;">
                            <span id="step-size-value" style="font-size: 11px; text-align: center; display: block;">0.25 units</span>
                        </div>

                        <!-- Selected Object Info -->
                        <div id="selected-info" style="font-size: 11px; color: #666; margin-top: 10px; padding-top: 10px; border-top: 1px solid #ddd;">
                            No object selected
                        </div>
                    </div>
                </div>
                    <canvas id="model-canvas"></canvas>
                    <div id="joint-markers-container"></div>
                    <div id="set-markers-container"></div>
                    <div id="phase-markers-container"></div>
                    <div id="load-displays-container"></div>
                </div>
            </div>
        </div>

        <div class="mb-3">
            <a href="{% url 'load_cases' %}" class="btn btn-outline-primary">
                ‚ö° Go to Load Cases Selection
            </a>
        </div>

        <!-- NEW: Compact Model Selection & Upload Section -->
        <div class="model-controls-container">
            <!-- Model Selection Card -->
            <div class="model-control-card">
                <div class="model-control-header">
                    <h6>Select 3D Tower Model</h6>
                </div>
                <div class="model-control-body">
                <form method="post" class="compact-form">
                    {% csrf_token %}
                    <div class="form-group-compact">
                        <label for="model-select">Model:</label>
                        <select name="selected_model" id="model-select" class="form-control-sm" onchange="this.form.submit()">
                            <option value="">-- Default Model --</option>
                            {% for model in available_models %}
                                <option value="{{ model.id }}" 
                                    {% if selected_model and selected_model.id == model.id %}selected{% endif %}>
                                    {{ model.name }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="model-status">
                        {% if selected_model %}
                            Currently viewing: <strong>{{ selected_model.name }}</strong>
                            {% if matching_model and selected_model.id == matching_model.id %}
                                <span class="badge badge-success ml-2">Auto-Matched</span>
                            {% else %}
                                <span class="badge badge-info ml-2">Manually Selected</span>
                            {% endif %}
                        {% else %}
                            Using default tower model
                        {% endif %}
                    </div>
                </form>
            </div>

            </div>

            <!-- Model Upload Card -->
            <div class="model-control-card">
    <div class="model-control-header">
        <h6>Upload New 3D Tower Model</h6>
    </div>
    <div class="model-control-body">
        <form method="post" enctype="multipart/form-data" class="compact-form">
            {% csrf_token %}
            <div class="form-row">
                <div class="form-group-compact">
                    <label for="model_name">Model Name:</label>
                    <input type="text" name="model_name" id="model_name" class="form-control-sm" placeholder="Enter model name" required>
                </div>
                <div class="form-group-compact">
                    <label for="tower_model_file">3D Model File:</label>
                    <div class="file-input-wrapper">
                        <input type="file" name="tower_model_file" id="tower_model_file" accept=".glb,.gltf" required>
                        <div class="file-input-display">
                            <span>Choose file...</span>
                            <span class="file-input-icon">üìÅ</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ADD THESE FIELDS FOR CATEGORIZATION -->
            <div class="form-row">
                <div class="form-group-compact">
                    <label for="structure_type">Structure Type:</label>
                    <select name="structure_type" id="structure_type" class="form-control-sm" required>
                        <option value="">Select...</option>
                        <option value="towers">Towers</option>
                        <option value="hframes">H-Frames</option>
                        <option value="monopoles">Monopoles</option>
                    </select>
                </div>
                <div class="form-group-compact">
                    <label for="attachment_points">Attachment Points:</label>
                    <select name="attachment_points" id="attachment_points" class="form-control-sm" required>
                        <option value="">Select...</option>
                        <option value="deadend">Deadend</option>
                        <option value="tangent">Tangent</option>
                    </select>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group-compact">
                    <label for="configuration">Configuration:</label>
                    <select name="configuration" id="configuration" class="form-control-sm" required>
                        <option value="">Select...</option>
                        <option value="vertical">Vertical</option>
                        <option value="horizontal">Horizontal</option>
                        <option value="delta">Delta</option>
                        <option value="hetic">Hetic</option>
                    </select>
                </div>
                <div class="form-group-compact">
                    <label for="circuit_type">Circuit Type:</label>
                    <select name="circuit_type" id="circuit_type" class="form-control-sm" required>
                        <option value="">Select...</option>
                        <option value="sc">Single Circuit</option>
                        <option value="dc">Double Circuit</option>
                        <option value="tc">Triple Circuit</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group-compact">
                <button type="submit" class="btn-sm-compact btn-success-sm">Upload</button>
            </div>
            
            <div class="form-text">
                <small class="text-muted">Supported formats: .glb, .gltf (Max file size: 10MB)</small>
            </div>
        </form>
    </div>
</div>

        </div>
        
<div class="model-matching-info" style="background-color: #e8f5e8; padding: 15px; margin: 10px 0; border-radius: 5px; border-left: 4px solid #4CAF50;">
    <h5>üéØ 3D Model Matching</h5>
    
    <div class="row">
        <div class="col-md-6">
        <h6>User Selections:</h6>
        <ul>
            <li><strong>Structure Type:</strong> {{ session_structure_type|default:"Not set" }}</li>
            <li><strong>Attachment Points:</strong> {{ session_popup_selections.attachment_points|default:"Not set" }}</li>
            <li><strong>Configuration:</strong> {{ session_popup_selections.configuration|default:"Not set" }}</li>
            <li><strong>3-Phase Circuits:</strong> {{ session_circuit_definition.num_3_phase_circuits|default:"0" }}</li>
            <li><strong>Shield Wires:</strong> {{ session_circuit_definition.num_shield_wires|default:"0" }}</li>
            <li><strong>1-Phase Circuits:</strong> {{ session_circuit_definition.num_1_phase_circuits|default:"0" }}</li>
            <li><strong>Communication Cables:</strong> {{ session_circuit_definition.num_communication_cables|default:"0" }}</li>
            <li><strong>Total Circuits:</strong> 
                {% with num_3_phase=session_circuit_definition.num_3_phase_circuits|default:0|add:0 num_1_phase=session_circuit_definition.num_1_phase_circuits|default:0|add:0 num_comm=session_circuit_definition.num_communication_cables|default:0|add:0 %}
                    {{ num_3_phase|add:num_1_phase|add:num_comm }}
                {% endwith %}
            </li>
        </ul>
    </div>
        
        <div class="col-md-6">
            <h6>Matched 3D Model:</h6>
            {% if matching_model %}
                <div class="alert alert-success">
                    <strong>‚úì Model Found!</strong><br>
                    <strong>Name:</strong> {{ matching_model.name }}<br>
                    <strong>Type:</strong> {{ matching_model.get_structure_type_display }}<br>
                    <strong>Attachment:</strong> {{ matching_model.get_attachment_points_display|default:"-" }}<br>
                    <strong>Configuration:</strong> {{ matching_model.get_configuration_display|default:"-" }}<br>
                    <strong>Circuit:</strong> {{ matching_model.get_circuit_type_display|default:"-" }}
                </div>
            {% else %}
                <div class="alert alert-warning">
                    <strong>‚ö† No Exact Match Found</strong><br>
                    Using default model or manually selected model.
                </div>
            {% endif %}
        </div>
    </div>
</div>
<div class="session-debug" style="background-color: #e8f4f8; padding: 15px; margin: 10px 0; border-radius: 5px; border-left: 4px solid #2196F3;">
    <h5>üìä Session Data Summary</h5>
    
    <div class="row">
        <div class="col-md-6">
            <h6>Home Page Data:</h6>
            <ul>
               
                <li><strong>Active Popups:</strong> 
                    {% if session_active_popups %}
                        {{ session_active_popups|join:", " }}
                    {% else %}
                        None
                    {% endif %}
                </li>
            </ul>
            
            <h6>Popup Selections:</h6>
            <ul>
                {% for key, value in session_popup_selections.items %}
                    <li><strong>{{ key }}:</strong> {{ value }}</li>
                {% empty %}
                    <li>No popup selections</li>
                {% endfor %}
            </ul>
        </div>
        
        <div class="col-md-6">
            <h6>Circuit Definition Data:</h6>
            {% if session_circuit_definition %}
                <ul>
                    <li><strong>3-Phase Circuits:</strong> {{ session_circuit_definition.num_3_phase_circuits|default:"Not set" }}</li>
                    <li><strong>Shield Wires:</strong> {{ session_circuit_definition.num_shield_wires|default:"Not set" }}</li>
                    <li><strong>1-Phase Circuits:</strong> {{ session_circuit_definition.num_1_phase_circuits|default:"Not set" }}</li>
                    <li><strong>Communication Cables:</strong> {{ session_circuit_definition.num_communication_cables|default:"Not set" }}</li>
                  
                </ul>
            {% else %}
                <p>No circuit definition data available</p>
            {% endif %}
        </div>
    </div>
</div>

<!-- Include Three.js library -->
<script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/loaders/GLTFLoader.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/TransformControls.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>



<script>
    // Load data passed from Django
    const loadData = JSON.parse('{{ load_data_json|escapejs }}');
    
    // Three.js variables
    let scene, camera, renderer, model, controls, raycaster, mouse;
    const jointMarkers = {};
    const selectedJoints = new Set();
    const loadDisplays = {};
    const setMarkers = {};
    const phaseMarkers = {};
    const selectedSets = new Set();
    const selectedPhases = new Set();
    let activeJoint = null;
    const selectedRecords = new Set();
    let allTableData = [];
    const setPhaseCombinations = new Map(); // Track all active combinations
    let combinationCounter = 0; // Counter to make each combination unique
    const activeCombinations = new Map();
    let currentDroppingItem = null; // Stores data of the label being dragged from the sidebar
    let combinationsToConfirm = []; 
    const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
    let gridHelpers = []; // Array to store all grid helpers
    let isGridVisible = true;
    let transformControls;
    let selectedObject = null;

    // NEW: Enhanced movement and drag variables
    let isDragging = false;
    let dragStartPosition = new THREE.Vector3();
    let currentDragObject = null;
    let dropMode = 'precise'; // 'precise' or 'free'
    let gridSnapValue = 0.25;
    let movementStep = 0.25;
    let isDragOverCanvas = false;
    
    document.addEventListener('DOMContentLoaded', function() {
    // Ensure the canvas container is visible and properly sized
    const canvasContainer = document.querySelector('.model-viewer-container');
    const canvas = document.getElementById('model-canvas');
    
    if (canvasContainer && canvas) {
        // Force the container to be visible and properly sized
        canvasContainer.style.display = 'block';
        canvas.style.display = 'block';
        
        // Initialize the model viewer regardless of button type
        initModelViewer();
        updateTable();
        
        // Initialize the appropriate selection based on button type
        {% if button_type == 'set_phase' %}
            initSetPhaseSelection();
        {% elif button_type == 'joint_labels' %}
            // Ensure joint labels functionality is initialized
            initJointLabelsSelection();
        {% endif %}
    }
});

// Add this function if it doesn't exist
function initJointLabelsSelection() {
    const jointContainer = document.getElementById('joint-labels');
    if (jointContainer) {
        jointContainer.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const jointValue = this.value;
                if (this.checked) {
                    selectedJoints.add(jointValue);
                    if (!jointMarkers[jointValue]) {
                        addJointMarker(jointValue);
                    }
                } else {
                    selectedJoints.delete(jointValue);
                    removeJointMarker(jointValue);
                }
                updateTable();
                syncSelectionsWithSession();
            });
        });
    }
}
    // Initialize the 3D model viewer
        // Initialize the 3D model viewer
    function initModelViewer() {
        // Existing scene setup code remains the same until after renderer creation...
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0xf0f0f0);

        const axesHelper = new THREE.AxesHelper(5);
        scene.add(axesHelper);

        const canvasContainer = document.querySelector('.model-viewer-container');
        camera = new THREE.PerspectiveCamera(75, canvasContainer.clientWidth / canvasContainer.clientHeight, 0.1, 1000);
        camera.position.set(5, 5, 5);

        const canvas = document.getElementById('model-canvas');
        renderer = new THREE.WebGLRenderer({
            canvas,
            antialias: true,
            alpha: true
        });

        updateRendererSize();
        initTransformControls();

        controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.25;

        raycaster = new THREE.Raycaster();
        mouse = new THREE.Vector2();

        const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight.position.set(1, 1, 1);
        scene.add(directionalLight);

        const directionalLight2 = new THREE.DirectionalLight(0xffffff, 0.4);
        directionalLight2.position.set(-1, -1, -1);
        scene.add(directionalLight2);

        // Load GLB model
        const loader = new THREE.GLTFLoader();
    function loadTowerModel(modelUrl) {
    // Remove existing model if any
    if (model) {
        scene.remove(model);
        model = null;
    }
    
    loader.load(
        modelUrl,
        function (gltf) {
            model = gltf.scene;
            scene.add(model);
            console.log('‚úÖ Model loaded successfully:', modelUrl);
            
            // Center and scale model
            const box = new THREE.Box3().setFromObject(model);
            const center = box.getCenter(new THREE.Vector3());
            const size = box.getSize(new THREE.Vector3());
            model.position.sub(center);
            
            create3DGridCage(box);
            model.rotation.y = Math.PI / 4;
            
            // Initialize event listeners
            initEnhancedEventListeners();
            animate();
        },
        undefined,
        function (error) {
            console.error('‚ùå Error loading model:', error);
            console.log('Trying to load fallback model...');
            
            // Try to load any available model as fallback
            {% if available_models and available_models.0 %}
                const fallbackUrl = "{{ available_models.0.get_file_url }}";
                console.log('Loading fallback model:', fallbackUrl);
                loadTowerModel(fallbackUrl);
            {% else %}
                // Ultimate fallback
                const defaultModelUrl = "{% static 'app1/images/powerTransmissionTower.glb' %}";
                console.log('Loading ultimate fallback model:', defaultModelUrl);
                loadTowerModel(defaultModelUrl);
            {% endif %}
        }
    );
}

{% if matching_model %}
    // Get URLs for both matched and selected models
    const matchedModelUrl = "{{ matching_model.get_file_url }}";
    const selectedModelUrl = "{{ selected_model.get_file_url|default:'' }}";
    
    console.log('üîç Model Loading Analysis:');
    console.log('  Matched Model:', "{{ matching_model.name }}", matchedModelUrl);
    console.log('  Selected Model:', "{{ selected_model.name|default:'None' }}", selectedModelUrl);
    
    // Verify they're the same
    if (selectedModelUrl && matchedModelUrl === selectedModelUrl) {
        console.log('‚úÖ Matched and selected models are the same');
        console.log('üéØ Auto-loading matched model:', matchedModelUrl);
        console.log('Model details:', {
            name: "{{ matching_model.name }}",
            type: "{{ matching_model.structure_type }}",
            attachment: "{{ matching_model.attachment_points }}",
            config: "{{ matching_model.configuration }}",
            circuit: "{{ matching_model.circuit_type }}"
        });
        loadTowerModel(matchedModelUrl);
    } else if (selectedModelUrl && selectedModelUrl !== matchedModelUrl) {
        console.log('‚ö†Ô∏è Matched and selected models differ!');
        console.log('Loading selected model (user choice overrides match):', selectedModelUrl);
        loadTowerModel(selectedModelUrl);
    } else {
        // No selected model, use matched model
        console.log('üéØ Auto-loading matched model:', matchedModelUrl);
        console.log('Model details:', {
            name: "{{ matching_model.name }}",
            type: "{{ matching_model.structure_type }}",
            attachment: "{{ matching_model.attachment_points }}",
            config: "{{ matching_model.configuration }}",
            circuit: "{{ matching_model.circuit_type }}"
        });
        loadTowerModel(matchedModelUrl);
    }
{% else %}
    // No matching model found, use selected or default
    {% if selected_model %}
        const selectedModelUrl = "{{ selected_model.get_file_url }}";
        console.log('üìå Loading manually selected model:', selectedModelUrl);
        loadTowerModel(selectedModelUrl);
    {% else %}
        const defaultModelUrl = "{% static 'app1/images/powerTransmissionTower.glb' %}";
        console.log('‚öô Loading default model:', defaultModelUrl);
        loadTowerModel(defaultModelUrl);
    {% endif %}
{% endif %}

// Function to load default model
function loadDefaultModel() {
    loader.load(
       modelUrl,
        function (gltf) {
            model = gltf.scene;
            scene.add(model);

            const box = new THREE.Box3().setFromObject(model);
            const center = box.getCenter(new THREE.Vector3());
            const size = box.getSize(new THREE.Vector3());
            model.position.sub(center);

            create3DGridCage(box);
            model.rotation.y = Math.PI / 4;

            initEnhancedEventListeners();
            animate();
        },
        undefined,
        function (error) {
            console.error('Error loading default model:', error);
        }
    );
}


        window.addEventListener('resize', onWindowResize);
        renderer.domElement.addEventListener('click', onCanvasClick);
        
        // NEW: Add enhanced mouse event listeners for smooth dragging
        initEnhancedDragListeners();
    }

    function create3DGridCage(boundingBox) {
        const size = boundingBox.getSize(new THREE.Vector3());
        const center = boundingBox.getCenter(new THREE.Vector3());
        
        // Make grid slightly larger than model
        const gridSize = Math.max(size.x, size.y, size.z) * 1.2;
        const gridDivisions = 20;
        
        // Clear any existing grids
        clearAllGrids();
        
        // Create grids on different planes
        
        // XY Plane (front/back)
        const gridXY1 = new THREE.GridHelper(gridSize, gridDivisions, 0xff4444, 0xff8888);
        gridXY1.position.set(center.x, center.y, boundingBox.min.z - 1);
        gridXY1.rotation.x = Math.PI / 2;
        scene.add(gridXY1);
        gridHelpers.push(gridXY1);
        
        const gridXY2 = new THREE.GridHelper(gridSize, gridDivisions, 0xff4444, 0xff8888);
        gridXY2.position.set(center.x, center.y, boundingBox.max.z + 1);
        gridXY2.rotation.x = Math.PI / 2;
        scene.add(gridXY2);
        gridHelpers.push(gridXY2);
        
        // XZ Plane (ground/top)
        const gridXZ1 = new THREE.GridHelper(gridSize, gridDivisions, 0x44ff44, 0x88ff88);
        gridXZ1.position.set(center.x, boundingBox.min.y - 1, center.z);
        scene.add(gridXZ1);
        gridHelpers.push(gridXZ1);
        
        const gridXZ2 = new THREE.GridHelper(gridSize, gridDivisions, 0x44ff44, 0x88ff88);
        gridXZ2.position.set(center.x, boundingBox.max.y + 1, center.z);
        scene.add(gridXZ2);
        gridHelpers.push(gridXZ2);
        
        // YZ Plane (left/right)
        const gridYZ1 = new THREE.GridHelper(gridSize, gridDivisions, 0x4444ff, 0x8888ff);
        gridYZ1.position.set(boundingBox.min.x - 1, center.y, center.z);
        gridYZ1.rotation.z = Math.PI / 2;
        scene.add(gridYZ1);
        gridHelpers.push(gridYZ1);
        
        const gridYZ2 = new THREE.GridHelper(gridSize, gridDivisions, 0x4444ff, 0x8888ff);
        gridYZ2.position.set(boundingBox.max.x + 1, center.y, center.z);
        gridYZ2.rotation.z = Math.PI / 2;
        scene.add(gridYZ2);
        gridHelpers.push(gridYZ2);
        
        isGridVisible = true;
    }

    function toggleGrid() {
        isGridVisible = !isGridVisible;
        
        gridHelpers.forEach(grid => {
            grid.visible = isGridVisible;
        });
        
        // Update button text
        const gridToggleBtn = document.getElementById('grid-toggle-btn');
        if (gridToggleBtn) {
            gridToggleBtn.textContent = isGridVisible ? 'Hide Grid' : 'Show Grid';
            gridToggleBtn.className = isGridVisible ? 'btn btn-warning btn-sm' : 'btn btn-success btn-sm';
        }
    }

</script>